<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分数大小比較チャレンジ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        html, body {
            /* Prevent scrolling on touch devices like iPad */
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            touch-action: manipulation;
        }
        .fraction {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            margin: 0 1rem;
            font-size: 2.5rem;
            line-height: 1.1;
        }
        .numerator {
            padding-bottom: 0.25rem;
        }
        .denominator {
            border-top: 2px solid currentColor;
            padding-top: 0.25rem;
        }
        .hidden {
            display: none;
        }
        #scratchpad {
            border: 2px solid #4a5568;
            border-radius: 0.5rem;
            cursor: crosshair;
        }
        .answer-btn {
            font-size: 2.5rem;
            width: 80px;
            height: 80px;
            transition: all 0.2s ease-in-out;
        }
        .answer-btn:hover {
            transform: scale(1.1);
            background-color: #4a5568;
        }
        .question-count-btn {
            padding: 0.5rem 1rem;
            border: 2px solid #4a5568;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .question-count-btn:hover {
            background-color: #4a5568;
        }
        .question-count-btn.selected {
            background-color: #2dd4bf;
            border-color: #2dd4bf;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div id="main-container" class="w-full max-w-2xl mx-auto">

        <!-- スタート画面 -->
        <div id="start-screen" class="text-center bg-gray-800 p-8 rounded-xl shadow-2xl">
            <h1 class="text-4xl font-bold mb-4 text-cyan-400">分数大小比較チャレンジ</h1>
            <div class="text-left max-w-md mx-auto space-y-3 text-gray-300">
                <p>🚀 2つの分数の大小関係を答えるクイズです。</p>
                <p>⏱️ 設定した問題数に正解するまでのタイムを競います。</p>
                <p> Penalties 1問間違えるごとに、最終タイムに3秒が加算されます。</p>
                <p>✍️ 画面下のエリアに自由に計算メモができます。</p>
            </div>

            <div class="mt-6">
                <p class="text-lg font-semibold text-gray-400 mb-3">問題数を選択:</p>
                <div id="question-count-selector" class="flex justify-center space-x-2 md:space-x-4">
                    <button class="question-count-btn selected" data-count="3">3問</button>
                    <button class="question-count-btn" data-count="5">5問</button>
                    <button class="question-count-btn" data-count="10">10問</button>
                </div>
            </div>

            <button id="start-button" class="mt-8 bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg text-xl transition duration-300 transform hover:scale-105">
                スタート！
            </button>
        </div>

        <!-- ゲーム画面 -->
        <div id="game-screen" class="hidden bg-gray-800 p-6 md:p-8 rounded-xl shadow-2xl">
            <!-- ヘッダー情報 -->
            <div class="flex justify-between items-center mb-6 text-lg">
                <div class="bg-gray-700 px-4 py-2 rounded-lg">
                    正解数: <span id="correct-count" class="font-bold text-xl text-green-400">0</span> / <span id="target-count">10</span>
                </div>
                <div class="bg-gray-700 px-4 py-2 rounded-lg">
                    タイム: <span id="timer" class="font-bold text-xl text-yellow-400">0.00</span>
                </div>
            </div>

            <!-- 問題表示 -->
            <div id="question-area" class="flex items-center justify-center my-8 md:my-12">
                <div id="frac1" class="fraction">
                    <span class="numerator">1</span>
                    <span class="denominator">2</span>
                </div>
                <div id="placeholder" class="text-5xl font-bold text-cyan-400">?</div>
                <div id="frac2" class="fraction">
                    <span class="numerator">2</span>
                    <span class="denominator">3</span>
                </div>
            </div>

            <!-- 解答ボタン -->
            <div id="answer-buttons" class="flex justify-center space-x-4 md:space-x-8 my-8">
                <button class="answer-btn bg-gray-700 rounded-full flex items-center justify-center" data-answer="<">&lt;</button>
                <button class="answer-btn bg-gray-700 rounded-full flex items-center justify-center" data-answer="=">=</button>
                <button class="answer-btn bg-gray-700 rounded-full flex items-center justify-center" data-answer=">">&gt;</button>
            </div>

            <!-- 計算エリア -->
            <div class="mt-8 text-center">
                <div class="flex justify-between items-center mb-2">
                    <h3 class="text-lg font-semibold text-gray-400">計算エリア</h3>
                    <button id="clear-canvas-btn" class="bg-red-600 hover:bg-red-700 text-white text-sm font-bold py-1 px-4 rounded-md transition duration-300">
                        クリア
                    </button>
                </div>
                <canvas id="scratchpad"></canvas>
            </div>
        </div>

        <!-- 結果画面 -->
        <div id="result-screen" class="hidden bg-gray-800 p-6 md:p-8 rounded-xl shadow-2xl">
            <h2 class="text-4xl font-bold text-center mb-6 text-cyan-400">結果</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center mb-8">
                <div class="bg-gray-700 p-4 rounded-lg">
                    <p class="text-sm text-gray-400">かかった時間</p>
                    <p id="result-time" class="text-2xl font-bold"></p>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg">
                    <p class="text-sm text-gray-400">ペナルティ</p>
                    <p id="result-penalty" class="text-2xl font-bold text-red-400"></p>
                </div>
                <div class="bg-gray-700 p-4 rounded-lg">
                    <p class="text-sm text-gray-400">最終スコア</p>
                    <p id="result-score" class="text-3xl font-bold text-yellow-400"></p>
                </div>
            </div>

            <h3 class="text-xl font-bold text-center mb-4">問題の振り返り</h3>
            <div class="max-h-60 overflow-y-auto bg-gray-900 rounded-lg p-2">
                <table class="w-full text-sm text-left">
                    <thead class="text-xs text-gray-400 uppercase bg-gray-700">
                        <tr>
                            <th class="px-4 py-2">#</th>
                            <th class="px-4 py-2">問題</th>
                            <th class="px-4 py-2">あなたの解答</th>
                            <th class="px-4 py-2 text-center">結果</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body">
                        <!-- 結果がここに挿入されます -->
                    </tbody>
                </table>
            </div>

            <div class="text-center mt-8">
                <button id="restart-button" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg text-xl transition duration-300 transform hover:scale-105">
                    もう一度挑戦する
                </button>
            </div>
        </div>
    </div>

    <script>
        // DOM要素の取得
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const resultScreen = document.getElementById('result-screen');
        const startButton = document.getElementById('start-button');
        const restartButton = document.getElementById('restart-button');
        const correctCountEl = document.getElementById('correct-count');
        const targetCountEl = document.getElementById('target-count');
        const timerEl = document.getElementById('timer');
        const frac1El = document.getElementById('frac1');
        const frac2El = document.getElementById('frac2');
        const answerButtons = document.querySelectorAll('.answer-btn');
        const canvas = document.getElementById('scratchpad');
        const clearCanvasBtn = document.getElementById('clear-canvas-btn');
        const resultTimeEl = document.getElementById('result-time');
        const resultPenaltyEl = document.getElementById('result-penalty');
        const resultScoreEl = document.getElementById('result-score');
        const historyTableBodyEl = document.getElementById('history-table-body');
        const placeholderEl = document.getElementById('placeholder');
        const questionCountSelector = document.getElementById('question-count-selector');

        // ゲーム状態変数
        let correctCount = 0;
        let wrongCount = 0;
        let targetCorrectCount = 3;
        let timerInterval;
        let startTime;
        let history = [];
        let currentQuestion = {};

        // Canvas設定
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        function resizeCanvas() {
            const containerWidth = canvas.parentElement.clientWidth;
            canvas.width = containerWidth;
            canvas.height = containerWidth / 2;
            if (canvas.height > 250) canvas.height = 250;
            ctx.strokeStyle = '#a0aec0';
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
        }

        // --- イベントリスナー ---
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', () => {
            resultScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
        });
        answerButtons.forEach(button => {
            button.addEventListener('click', () => checkAnswer(button.dataset.answer));
        });
        clearCanvasBtn.addEventListener('click', () => {
             ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        questionCountSelector.addEventListener('click', (e) => {
            if (e.target.classList.contains('question-count-btn')) {
                document.querySelectorAll('.question-count-btn').forEach(btn => btn.classList.remove('selected'));
                e.target.classList.add('selected');
                targetCorrectCount = parseInt(e.target.dataset.count, 10);
            }
        });

        // Canvas描画イベント (PC)
        canvas.addEventListener('mousedown', (e) => startDrawing(e.offsetX, e.offsetY));
        canvas.addEventListener('mousemove', (e) => draw(e.offsetX, e.offsetY));
        canvas.addEventListener('mouseup', () => stopDrawing());
        canvas.addEventListener('mouseout', () => stopDrawing());

        // Canvas描画イベント (モバイル)
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            const rect = e.target.getBoundingClientRect();
            startDrawing(e.targetTouches[0].clientX - rect.left, e.targetTouches[0].clientY - rect.top);
        });
        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault();
            const rect = e.target.getBoundingClientRect();
            draw(e.targetTouches[0].clientX - rect.left, e.targetTouches[0].clientY - rect.top);
        });
        canvas.addEventListener('touchend', stopDrawing);

        window.addEventListener('resize', resizeCanvas);


        // --- Canvas関数 ---
        function startDrawing(x, y) {
            isDrawing = true;
            [lastX, lastY] = [x, y];
        }

        function draw(x, y) {
            if (!isDrawing) return;
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(x, y);
            ctx.stroke();
            [lastX, lastY] = [x, y];
        }

        function stopDrawing() {
            isDrawing = false;
        }

        // --- ゲームロジック ---
        function startGame() {
            correctCount = 0;
            wrongCount = 0;
            history = [];
            correctCountEl.textContent = '0';
            targetCountEl.textContent = targetCorrectCount;

            startScreen.classList.add('hidden');
            resultScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');

            resizeCanvas();
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 100);
            updateTimer();

            nextQuestion();
        }

        function updateTimer() {
            const elapsedTime = (Date.now() - startTime) / 1000;
            timerEl.textContent = elapsedTime.toFixed(2);
        }

        function generateFractions() {
            let num1, den1, num2, den2;

            // 分母が同じにならないように生成
            do {
                den1 = Math.floor(Math.random() * 9) + 2; // 2-10
                den2 = Math.floor(Math.random() * 9) + 2; // 2-10
            } while (den1 === den2);

            num1 = Math.floor(Math.random() * (den1 - 1)) + 1; // 分子は分母より小さい
            num2 = Math.floor(Math.random() * (den2 - 1)) + 1;

            // 5%の確率で等しい分数を生成 (例: 1/2 と 3/6)
            if (Math.random() < 0.05) {
                const multiplier = Math.floor(Math.random() * 3) + 2; // 2,3,4
                num2 = num1 * multiplier;
                den2 = den1 * multiplier;
            }

            const val1 = num1 / den1;
            const val2 = num2 / den2;

            let answer;
            if (Math.abs(val1 - val2) < 0.0001) { // 浮動小数点誤差を考慮
                answer = '=';
            } else if (val1 < val2) {
                answer = '<';
            } else {
                answer = '>';
            }

            return {
                frac1: { num: num1, den: den1 },
                frac2: { num: num2, den: den2 },
                answer: answer
            };
        }

        function nextQuestion() {
            currentQuestion = generateFractions();

            frac1El.innerHTML = `<span class="numerator">${currentQuestion.frac1.num}</span><span class="denominator">${currentQuestion.frac1.den}</span>`;
            frac2El.innerHTML = `<span class="numerator">${currentQuestion.frac2.num}</span><span class="denominator">${currentQuestion.frac2.den}</span>`;
            placeholderEl.textContent = '?';
            placeholderEl.classList.remove('text-green-400', 'text-red-400');
            placeholderEl.classList.add('text-cyan-400');
        }

        function checkAnswer(userAnswer) {
            const isCorrect = userAnswer === currentQuestion.answer;

            history.push({
                question: currentQuestion,
                userAnswer: userAnswer,
                isCorrect: isCorrect
            });

            placeholderEl.textContent = isCorrect ? '✓' : '✗';
            placeholderEl.classList.remove('text-cyan-400');
            placeholderEl.classList.add(isCorrect ? 'text-green-400' : 'text-red-400');

            if (isCorrect) {
                correctCount++;
                correctCountEl.textContent = correctCount;
            } else {
                wrongCount++;
            }

            if (correctCount >= targetCorrectCount) {
                endGame();
            } else {
                setTimeout(nextQuestion, 800);
            }
        }

        function endGame() {
            clearInterval(timerInterval);
            const elapsedTime = (Date.now() - startTime) / 1000;
            const penalty = wrongCount * 3;
            const finalScore = elapsedTime + penalty;

            resultTimeEl.textContent = `${elapsedTime.toFixed(2)} 秒`;
            resultPenaltyEl.textContent = `+ ${penalty.toFixed(2)} 秒 (${wrongCount}問)`;
            resultScoreEl.textContent = `${finalScore.toFixed(2)} 秒`;

            displayHistory();

            gameScreen.classList.add('hidden');
            resultScreen.classList.remove('hidden');
        }

        function displayHistory() {
            historyTableBodyEl.innerHTML = '';
            history.forEach((item, index) => {
                const q = item.question;
                const row = `
                    <tr class="border-b border-gray-700 ${item.isCorrect ? 'bg-gray-800' : 'bg-red-900/30'}">
                        <td class="px-4 py-2 font-medium">${index + 1}</td>
                        <td class="px-4 py-2">${q.frac1.num}/${q.frac1.den} ? ${q.frac2.num}/${q.frac2.den}</td>
                        <td class="px-4 py-2 font-bold ${item.isCorrect ? '' : 'text-red-400'}">
                            ${item.userAnswer}
                            ${!item.isCorrect ? `<span class="text-xs text-gray-400 ml-1">(正解: ${q.answer})</span>` : ''}
                        </td>
                        <td class="px-4 py-2 text-center text-xl">${item.isCorrect ? '✅' : '❌'}</td>
                    </tr>
                `;
                historyTableBodyEl.innerHTML += row;
            });
        }
    </script>
</body>
</html>




