<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Åå„Çì„Å∞„ÇåÔºÅ„É¢„É≥„Çπ„Çø„ÉºË®é‰ºêÈöä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@700;800&display=swap" rel="stylesheet">
    <style>
        /* Basic styles for preventing scroll and setting font */
        html, body {
            width: 100%;
            /* remove height and overflow to allow scrolling on small screens */
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%; /* Prevent font size adjustment on iOS */
        }
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            touch-action: manipulation; /* Disable double-tap to zoom */
        }
        /* 3D button effect styles */
        .btn-3d {
            transition: all 0.1s ease-out;
            box-shadow: 0 6px 0 #a3a3a3;
        }
        .btn-3d:active {
            transform: translateY(4px);
            box-shadow: 0 2px 0 #a3a3a3;
        }
        .btn-3d:disabled {
            transform: translateY(2px);
            box-shadow: 0 4px 0 #9ca3af;
            background-color: #d1d5db;
            cursor: not-allowed;
        }
        /* Animation keyframes */
        @keyframes spawn {
            0% { transform: scale(0.5) translateY(50px); opacity: 0; }
            70% { transform: scale(1.1) translateY(0); opacity: 1; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        .animate-spawn { animation: spawn 0.5s ease-out forwards; }
        @keyframes defeat {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(15deg); opacity: 0.5; }
            100% { transform: scale(0.1) rotate(-360deg); opacity: 0; }
        }
        .animate-defeat { animation: defeat 0.6s ease-in forwards; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        @keyframes celebrate-text {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .animate-celebrate { animation: celebrate-text 1s ease-in-out infinite; }
        @keyframes gameover-text {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.05) rotate(-2deg); }
            75% { transform: scale(1.05) rotate(2deg); }
        }
        .animate-gameover { animation: gameover-text 0.5s ease-in-out; }

        /* Utility class for canvas */
        .touch-none {
            touch-action: none;
        }
        /* Category tab styles */
        .category-tab {
            transition: all 0.2s ease-in-out;
        }
        .category-tab.active {
            background-color: #06b6d4; /* cyan-500 */
            color: white;
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-yellow-50 text-gray-800 flex items-center justify-center min-h-screen">
    <div id="app-container" class="w-full max-w-5xl mx-auto p-2 sm:p-4 text-center">

        <!-- Deck Selection Screen -->
        <div id="deck-selection-screen" class="space-y-4 sm:space-y-6">
            <h1 class="text-3xl sm:text-5xl font-extrabold text-amber-600">„Åå„Çì„Å∞„ÇåÔºÅ<br>„É¢„É≥„Çπ„Çø„ÉºË®é‰ºêÈöä</h1>
            <div class="bg-white p-4 sm:p-8 rounded-2xl shadow-lg">
                <h2 class="text-xl sm:text-3xl font-bold mb-4 sm:mb-6">„Å©„ÅÆ„Éá„ÉÉ„Ç≠„Åß„Åü„Åü„Åã„ÅÜÔºü</h2>
                <div id="deck-category-tabs" class="flex flex-wrap justify-center gap-2 mb-6"></div>
                <div id="deck-list" class="space-y-4 mb-6 max-h-60 sm:max-h-72 overflow-y-auto"></div>
                <button id="new-deck-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-5 sm:py-4 sm:px-6 w-full rounded-lg text-lg sm:text-2xl btn-3d">+ „ÅÇ„Åü„Çâ„Åó„ÅÑ„Éá„ÉÉ„Ç≠„Çí„Å§„Åè„Çã</button>
                <p class="text-xs sm:text-sm text-gray-500 mt-4 sm:mt-6">ÂäπÊûúÈü≥ÔºöOtoLogic</p>
            </div>
        </div>

        <!-- Deck Editor Screen -->
        <div id="deck-editor-screen" class="hidden space-y-4">
            <h2 class="text-2xl sm:text-4xl font-bold text-amber-600">„Éá„ÉÉ„Ç≠„ÅÆ„Å∏„Çì„Åó„ÇÖ„ÅÜ</h2>
            <div class="bg-white p-4 sm:p-8 rounded-2xl shadow-lg text-left">
                <div class="mb-4 sm:mb-6">
                    <label for="deck-name" class="font-bold text-lg sm:text-xl">„Éá„ÉÉ„Ç≠„ÅÆ„Å™„Åæ„Åà</label>
                    <input type="text" id="deck-name" class="w-full text-lg sm:text-xl p-2 sm:p-3 border rounded mt-2" placeholder="‰æãÔºö„Åã„Çì„Åò„ÉÜ„Çπ„Éà">
                </div>
                <div class="flex justify-between items-center mb-2">
                    <h3 class="font-bold text-lg sm:text-xl">„ÇÇ„Çì„Å†„ÅÑ„É™„Çπ„Éà</h3>
                </div>
                <div id="questions-list" class="space-y-2 mb-4 max-h-48 sm:max-h-60 overflow-y-auto p-2 sm:p-4 bg-gray-50 rounded min-h-[100px]"></div>
                <div class="border-t pt-4 sm:pt-6">
                    <h3 class="font-bold text-lg sm:text-xl mb-4">„ÅÇ„Åü„Çâ„Åó„ÅÑ„ÇÇ„Çì„Å†„ÅÑ</h3>
                    <div class="mb-4">
                         <label for="new-question" class="text-base sm:text-lg">„ÇÇ„Çì„Å†„ÅÑ</label>
                         <textarea id="new-question" rows="2" class="w-full p-2 sm:p-3 border rounded mt-1 text-base sm:text-lg" placeholder="‰æãÔºöÊó•Êú¨„ÅÆÈ¶ñÈÉΩ„ÅØÔºü"></textarea>
                    </div>
                    <div class="mb-4">
                        <label for="new-answer" class="text-base sm:text-lg">„Åì„Åü„Åà</label>
                        <input type="text" id="new-answer" class="w-full p-2 sm:p-3 border rounded mt-1 text-base sm:text-lg" placeholder="‰æãÔºöÊù±‰∫¨">
                    </div>
                    <button id="add-question-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 rounded-lg btn-3d text-lg sm:text-xl">„ÇÇ„Çì„Å†„ÅÑ„Çí„Å§„ÅÑ„Åã</button>
                </div>
            </div>
             <div class="grid grid-cols-2 gap-4 sm:gap-6 mt-4 sm:mt-6">
                 <button id="save-deck-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 sm:py-4 rounded-lg text-lg sm:text-2xl btn-3d">„Åª„Åû„Çì</button>
                 <button id="back-to-selection-btn" class="bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 sm:py-4 rounded-lg text-lg sm:text-2xl btn-3d">„ÇÇ„Å©„Çã</button>
            </div>
        </div>

        <!-- Number of Questions Selection Screen -->
        <div id="setup-screen" class="hidden space-y-4 sm:space-y-6">
            <h1 id="setup-title" class="text-2xl sm:text-4xl font-extrabold text-amber-600"></h1>
            <div class="bg-white p-4 sm:p-8 rounded-2xl shadow-lg">
                <h2 class="text-xl sm:text-3xl font-bold mb-6">„Å™„Çì„Å≥„Åç „Å®„ÅÜ„Å∞„Å§„Åô„ÇãÔºü</h2>
                <div id="question-count-buttons" class="grid grid-cols-2 lg:grid-cols-4 gap-4"></div>
                 <button id="back-to-decks-btn" class="mt-6 w-full bg-gray-400 hover:bg-gray-500 text-white font-bold py-3 sm:py-4 rounded-lg text-lg sm:text-2xl btn-3d">„Éá„ÉÉ„Ç≠„Çí„Åà„Çâ„Å≥„Å™„Åä„Åô</button>
            </div>
        </div>

        <!-- Main Game Screen -->
        <div id="main-screen" class="hidden">
            <!-- Adjusted paddings, margins, heights, and font sizes for better mobile view -->
            <div class="bg-white p-3 sm:p-6 rounded-2xl shadow-lg relative">
                <!-- NEW: Top section layout updated to prevent button overlap -->
                <div class="flex justify-between items-start gap-4 mb-3">
                    <!-- Left part with title, counter, timer -->
                    <div class="flex-1">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-3">
                            <h2 id="monster-title" class="text-lg sm:text-2xl md:text-3xl font-bold text-amber-600 order-2 sm:order-1 mt-2 sm:mt-0"></h2>
                            <p id="counter" class="text-sm sm:text-xl font-bold bg-gray-200 px-3 py-1 sm:px-5 sm:py-2 rounded-full order-1 sm:order-2 self-end sm:self-center"></p>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-3 sm:h-4">
                            <div id="timer-bar" class="bg-gradient-to-r from-yellow-400 to-red-500 h-3 sm:h-4 rounded-full" style="width: 100%; transition: width 1s linear;"></div>
                        </div>
                    </div>
                    <!-- Right part with buttons -->
                    <div id="game-buttons" class="flex flex-col space-y-3">
                        <button id="correct-btn" class="bg-green-500 hover:bg-green-600 text-white font-extrabold py-2 px-4 sm:py-3 sm:px-5 rounded-xl text-base sm:text-xl btn-3d">„Åõ„ÅÑ„Åã„ÅÑÔºÅ</button>
                        <button id="retry-btn" class="bg-orange-500 hover:bg-orange-600 text-white font-extrabold py-2 px-4 sm:py-3 sm:px-5 rounded-xl text-base sm:text-xl btn-3d">Ëß£„ÅçÁõ¥„Åó</button>
                    </div>
                </div>

                <div id="lives-area" class="flex justify-center gap-2 sm:gap-3 text-2xl sm:text-3xl mb-3"></div>
                <div class="bg-gray-100 p-2 sm:p-4 rounded-lg my-3 sm:my-4 min-h-[80px] sm:min-h-[120px] flex flex-col justify-center">
                    <div id="question-display" class="text-xl sm:text-3xl font-bold"></div>
                </div>

                <!-- UPDATED: Monster area height for responsive monster size -->
                <div id="monster-area" class="h-36 sm:h-48 flex items-center justify-center"></div>

                <div class="my-3 sm:my-4">
                    <label class="font-bold text-left block mb-2 text-gray-600 text-base sm:text-lg">„Åì„Åü„Åà„Çí„Åã„ÅÑ„Å¶„Åø„Çà„ÅÜÔºÅ</label>
                    <canvas id="handwriting-canvas" class="bg-white border-2 border-gray-300 rounded-lg w-full h-36 sm:h-56 cursor-crosshair touch-none"></canvas>
                    <button id="clear-canvas-btn" class="mt-3 w-full sm:w-1/2 mx-auto bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 sm:py-3 rounded-lg btn-3d text-base sm:text-lg">„Åë„Åô</button>
                </div>
            </div>
        </div>

        <!-- Clear Screen -->
        <div id="clear-screen" class="hidden">
            <canvas id="confetti-canvas" class="absolute top-0 left-0 w-full h-full pointer-events-none"></canvas>
            <div class="bg-white p-6 sm:p-12 rounded-2xl shadow-2xl space-y-4 sm:space-y-6">
                <h1 class="text-3xl sm:text-6xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-red-500 to-yellow-500 animate-celebrate">„Åú„Çì„Å∂ „ÇÑ„Å£„Å§„Åë„ÅüÔºÅ<br>„Åä„ÇÅ„Åß„Å®„ÅÜÔºÅ</h1>
                <p class="text-7xl sm:text-9xl">üèÜ‚ú®üéâ</p>
                <div id="clear-results-area" class="text-left max-h-40 sm:max-h-60 overflow-y-auto bg-gray-50 p-4 sm:p-6 rounded-lg border"></div>
                <button class="restart-btn bg-cyan-400 hover:bg-cyan-500 text-white font-bold py-3 px-8 sm:py-5 sm:px-10 rounded-lg text-xl sm:text-3xl btn-3d">„ÇÇ„ÅÜ„ÅÑ„Å£„Åã„ÅÑ</button>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameover-screen" class="hidden">
            <div class="bg-gray-800 p-6 sm:p-12 rounded-2xl shadow-2xl space-y-4 sm:space-y-6 text-white">
                <h1 class="text-3xl sm:text-6xl font-extrabold text-red-500 animate-gameover">„Ç≤„Éº„É†„Ç™„Éº„Éê„Éº</h1>
                <p class="text-7xl sm:text-9xl">üò≠</p>
                <p class="text-lg sm:text-2xl">„Åñ„Çì„Å≠„Çì‚Ä¶<br>„Åæ„Åü„Å°„Çá„ÅÜ„Åõ„Çì„Åó„Å¶„Å≠ÔºÅ</p>
                <div id="gameover-results-area" class="text-left max-h-40 sm:max-h-60 overflow-y-auto bg-gray-700 p-4 sm:p-6 rounded-lg border border-gray-600"></div>
                <button class="restart-btn bg-cyan-400 hover:bg-cyan-500 font-bold py-3 px-8 sm:py-5 sm:px-10 rounded-lg text-xl sm:text-3xl btn-3d">„ÇÇ„ÅÜ„ÅÑ„Å£„Åã„ÅÑ</button>
            </div>
        </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const screens = {
            deckSelection: document.getElementById('deck-selection-screen'),
            deckEditor: document.getElementById('deck-editor-screen'),
            setup: document.getElementById('setup-screen'),
            main: document.getElementById('main-screen'),
            clear: document.getElementById('clear-screen'),
            gameover: document.getElementById('gameover-screen'),
        };
        const deckCategoryTabs = document.getElementById('deck-category-tabs');
        const deckList = document.getElementById('deck-list');
        const newDeckBtn = document.getElementById('new-deck-btn');
        const deckNameInput = document.getElementById('deck-name');
        const questionsList = document.getElementById('questions-list');
        const newQuestionInput = document.getElementById('new-question');
        const newAnswerInput = document.getElementById('new-answer');
        const addQuestionBtn = document.getElementById('add-question-btn');
        const saveDeckBtn = document.getElementById('save-deck-btn');
        const backToSelectionBtn = document.getElementById('back-to-selection-btn');
        const setupTitle = document.getElementById('setup-title');
        const questionCountButtons = document.getElementById('question-count-buttons');
        const backToDecksBtn = document.getElementById('back-to-decks-btn');
        const monsterTitle = document.getElementById('monster-title');
        const counter = document.getElementById('counter');
        const livesArea = document.getElementById('lives-area');
        const questionDisplay = document.getElementById('question-display');
        const monsterArea = document.getElementById('monster-area');
        const correctBtn = document.getElementById('correct-btn');
        const retryBtn = document.getElementById('retry-btn');
        const handwritingCanvas = document.getElementById('handwriting-canvas');
        const clearCanvasBtn = document.getElementById('clear-canvas-btn');
        const timerBar = document.getElementById('timer-bar');

        // --- Default Decks ---
        const defaultDecks = [
            { name: '1Âπ¥Áîü„ÅÆ„Åã„Çì„Åò', category: 'Â∞èÂ≠¶1Âπ¥Áîü', isDefault: true, questions: [{q:"Â±±", a:"„ÇÑ„Åæ"}, {q:"Â∑ù", a:"„Åã„Çè"}, {q:"Êó•", a:"„Å≤"}, {q:"Êúà", a:"„Å§„Åç"}, {q:"Êú®", a:"„Åç"}] },
            { name: '2Âπ¥Áîü„ÅÆ„Åã„Çì„Åò', category: 'Â∞èÂ≠¶2Âπ¥Áîü', isDefault: true, questions: [{q:"ÊôÇ", a:"„Å®„Åç"}, {q:"Êõú", a:"„Çà„ÅÜ"}, {q:"ÈÄ±", a:"„Åó„ÇÖ„ÅÜ"}, {q:"Êò•", a:"„ÅØ„Çã"}, {q:"Â§è", a:"„Å™„Å§"}] },
            { name: '3Âπ¥Áîü„ÅÆ„Åã„Çì„Åò', category: 'Â∞èÂ≠¶3Âπ¥Áîü', isDefault: true, questions: [{q:"ÈÉΩ", a:"„Åø„ÇÑ„Åì"}, {q:"Áúå", a:"„Åë„Çì"}, {q:"Â∏Ç", a:"„Åó"}, {q:"ÈßÖ", a:"„Åà„Åç"}, {q:"Â∫ó", a:"„Åø„Åõ"}] },
            { name: '4Âπ¥Áîü„ÅÆ„Åã„Çì„Åò', category: 'Â∞èÂ≠¶4Âπ¥Áîü', isDefault: true, questions: [{q:"Â∏≠", a:"„Åõ„Åç"}, {q:"Á™ì", a:"„Åæ„Å©"}, {q:"Ëªç", a:"„Åê„Çì"}, {q:"ÂÖµ", a:"„Å∏„ÅÑ"}, {q:"Ëá£", a:"„Åó„Çì"}] },
            { name: '5Âπ¥Áîü„ÅÆ„Åã„Çì„Åò', category: 'Â∞èÂ≠¶5Âπ¥Áîü', isDefault: true, questions: [{q:"Êîø", a:"„Åõ„ÅÑ"}, {q:"Ê≤ª", a:"„Åò"}, {q:"Áµå", a:"„Åë„ÅÑ"}, {q:"Ê∏à", a:"„Åñ„ÅÑ"}, {q:"Ê≠¥", a:"„Çå„Åç"}] },
            { name: '6Âπ¥Áîü„ÅÆ„Åã„Çì„Åò', category: 'Â∞èÂ≠¶6Âπ¥Áîü', isDefault: true, questions: [{q:"ÊÜ≤", a:"„Åë„Çì"}, {q:"Ê≥ï", a:"„Åª„ÅÜ"}, {q:"Ë£Å", a:"„Åï„ÅÑ"}, {q:"Âà§", a:"„Å∞„Çì"}, {q:"Áöá", a:"„Åì„ÅÜ"}] },
            { name: '„Å©„ÅÜ„Å∂„Å§„ÇØ„Ç§„Ç∫', category: '„Åù„ÅÆ‰ªñ', isDefault: true, questions: [{q:"‰∏ñÁïå„Åß‰∏ÄÁï™Â§ß„Åç„Å™ÂãïÁâ©„ÅØÔºü", a:"„Ç∑„É≠„Éä„Ç¨„Çπ„ÇØ„Ç∏„É©"}, {q:"È¶ñ„Åå‰∏ÄÁï™Èï∑„ÅÑÂãïÁâ©„ÅØÔºü", a:"„Ç≠„É™„É≥"}, {q:"Èºª„ÅåÈï∑„ÅÑÂãïÁâ©„ÅØÔºü", a:"„Çæ„Ç¶"}] },
        ];

        // --- Game State ---
        let allDecks = [];
        let currentDeckIndex = -1;
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let totalMonsters = 0;
        let defeatedMonsters = 0;
        let mistakes = 0;
        const MAX_MISTAKES = 3;
        let buttonsDisabled = false;
        let questionTimer = null;
        const TIME_LIMIT = 15;
        let selectedCategory = 'Â∞èÂ≠¶1Âπ¥Áîü';

        // --- Monster Data ---
        const MONSTERS = [
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhXNTz9LqGn-dTyacBt2n0JiCetzrkETOcF1neofXOypU1Zsb9afUTiMRm_G71xMuiuUH7WQKV8or5nhAARuDmTh7mp31wAh5mckUaUgTU3D_Hzz7hjDRsddYUWpXWrSdYrozHOj9heLMw/s170/monster01.png', emoji: 'üå±' },
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhcGlFVplWQL65fn-lrtazTQL6rvrthKW6gtO2EeHeeNDEP2nJtpdUhDLzsT60ucQ25WT3KYA7Iw2p0Ji9Kn1RvnmTWhVqc8XbvTIFUu9P6zabvrX4r78cSjnxhhWELWL7piPX4rUeSdnI/s170/monster02.png', emoji: 'üë®‚Äç' },
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEheSepCQGD9tU90G7ls1ufJ6LVwvFkjxrwiBzKumO7slJKxsf8QvrfMJjP2yj8ZSy5m5PM5KVh0vU8bVe7VtF36dMvoTNLDZXdzn5bR3mb-uwucFLKX-nEeMijuw9HiXOzC5IENJ5uKfFE/s170/monster03.png', emoji: 'üí™' },
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgrm2jo51T07UB6z83ceuz7AwQuTv3C_j-JfOmq7rRJptgH2xsSboxBLtVfhDwFO3R53Cl5nQiuE8aAkz0In702dv-Bp75S7cipUjtRwToNAEmGMZe1wNZPDachQ4p2eOWTAbq23kGvDno/s170/monster04.png', emoji: 'üëë' },
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgLcewHTO7BvACy7vf0mbeJo8gHXzznwUcJ_D615Cutcc_ix_t8UUYllNgqAE0QEe586HseeC3EJT_UZRhPzwpUmkdzU77PKEE9R_vSiD7qYtxMeDoemsGnKGzPPqDf3dmRLWcB_agvsUM/s170/monster05.png', emoji: 'üï∫' },
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiwf_Xp6Betg2IhK6EqdWnfa4l6wV7rniHFbBE7rMTnqE28eaEmUP6ZgZZusF5TxH_R-8r9ENcekbLJGgNpy4XoZzeaV6nGNeQz5V0pKo105ReDxbyLnIxUyODtmqZvGaRZmWmESTGcDXM/s170/monster06.png', emoji: 'üëπ' },
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj__yRJc635a99L5yetg9An8Y-Kgk055BufQNaWzz5p0MZX2JIYgSCLAgMrPmdxwl1nmW_yp59Wp1xNmm-raEjtYypJWsGDgQCcMKvAmWEkggPj9Di_pcF4yBoLb_FomQeXsq04-PtQbGM/s170/monster07.png', emoji: 'üëπ' },
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjGlhVDUtrBH4pfZmQmxvqY6PhZ-oKyejic_4guGF0i8gBZvZKITDwX1U8Frl1jSgxJ1j3BwjpI2MIgV40rqT9e5-wfVNd_1Us-bA5FnCuytfthrrDLGHSaSjn8l9Ik66JA8-Wg-YqQOQA/s800/monster08.png', emoji: 'üëπ' },
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhlGJd95yeHf7v5wPzLg4-lyxAI7yPHY4OzqxEdLY_Lf7DA3MvFsgh4SeUN2FNjg4juzBWIcFUNYGHOCIh3HTLAunpF4J-EpbRRkyhliav43vl4eyY6-ENhHnGPLmrc-OkwTRRcxa6m4cg/s170/monster09.png', emoji: 'üëπ' },
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjpni__YcXjSExJ6M74waXyzQKDw0zMwi0SZ0yl-0PAPALq2DO4sKlLcfR0Io8fkyFRRhzLPnp2NftJrthjbnmtSmJVoJNQ5pjHFM_zeYNmJsgYJIgVkzHFkgyMHlhr3uPt-ZZEqAysYCc/s170/monster10.png', emoji: 'üëπ' },
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhdW2bw5XFelBMMNMSx4_PST670AxRputfVYU_24fkGYmNeXerrd48CYIgE70vrT711Lwa5Xlgk1DqRSGjxfTZgpq26ky_TV5BazG_rhuMGufQgFFTBJE30qt04EHrTMRe2FqemO0Bk-bM/s170/monster11.png', emoji: 'üëπ' },
            { name: '„É¢„É≥„Çπ„Çø„Éº', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg_aBArC2jvlxaDm_rW1HV2niXtxb9MAhuwFIZSIvGrQDAEci0DQBimJKE56oxhb49c2EiDaf16YNWVlUIw_OBcdbltm4JN0DP2CazcRJqsdNnAs4gxK2wSvTC6x8qkcqoN4OwQ2tVy7KI/s170/monster12.png', emoji: 'üëπ' },
        ];
        const BOSS_MONSTER = { name: '„Éâ„É©„Ç¥„É≥', image: 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhWsvL0brkhZn9zU4BpyeOuPORRguZz4iPTopr4phHynEW0DATC9W5j11fWGDlghx_Eysn_5gGSLuBYybC28GRYzsPZB_qpNjFU8qMGpgL_fEi5iUfZv4GnEn_v-sI80WTqOPbSqrg1-3c/s180-c/fantasy_dragon.png', emoji: 'üêâ' };

        // --- Canvas State ---
        let canvasCtx;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        // --- Sound Effects ---
        function playSound(type) {
            const sound = new Audio(type === 'correct' ? 'sounds/correct.mp3' : 'sounds/incorrect.mp3');
            sound.play().catch(e => console.error(`Error playing ${type} sound:`, e));
        }

        // --- Screen Management ---
        function showScreen(screenId) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            screens[screenId].classList.remove('hidden');
        }

        // --- Deck Management ---
        function loadAndCombineDecks() {
            const userDecks = JSON.parse(localStorage.getItem('monsterDecks')) || [];
            allDecks = [...defaultDecks, ...userDecks];
        }

        function saveUserDecks() {
            const userDecks = allDecks.filter(deck => !deck.isDefault);
            localStorage.setItem('monsterDecks', JSON.stringify(userDecks));
        }

        function renderDeckSelectionScreen() {
            const categories = ['Â∞èÂ≠¶1Âπ¥Áîü', 'Â∞èÂ≠¶2Âπ¥Áîü', 'Â∞èÂ≠¶3Âπ¥Áîü', 'Â∞èÂ≠¶4Âπ¥Áîü', 'Â∞èÂ≠¶5Âπ¥Áîü', 'Â∞èÂ≠¶6Âπ¥Áîü', '„Åù„ÅÆ‰ªñ', '„Åò„Å∂„Çì„ÅÆ„Éá„ÉÉ„Ç≠'];
            deckCategoryTabs.innerHTML = categories.map(cat => `
                <button data-category="${cat}" class="category-tab px-3 py-2 text-sm sm:text-base sm:px-4 rounded-lg font-bold bg-gray-200 hover:bg-cyan-300 ${selectedCategory === cat ? 'active' : ''}">
                    ${cat}
                </button>
            `).join('');

            let decksToDisplay;
            if (selectedCategory === '„Åò„Å∂„Çì„ÅÆ„Éá„ÉÉ„Ç≠') {
                decksToDisplay = allDecks.filter(deck => !deck.isDefault);
            } else {
                decksToDisplay = allDecks.filter(deck => deck.category === selectedCategory);
            }

            deckList.innerHTML = '';
            if (decksToDisplay.length === 0) {
                deckList.innerHTML = `<p class="text-gray-500 text-base sm:text-xl">${selectedCategory === '„Åò„Å∂„Çì„ÅÆ„Éá„ÉÉ„Ç≠' ? '„Åæ„Å†„Éá„ÉÉ„Ç≠„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ<br>„ÅÇ„Åü„Çâ„Åó„ÅÑ„Éá„ÉÉ„Ç≠„Çí„Å§„Åè„Çç„ÅÜÔºÅ' : '„Åì„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÅÆ„Éá„ÉÉ„Ç≠„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ'}</p>`;
            } else {
                decksToDisplay.forEach(deck => {
                    const originalIndex = allDecks.indexOf(deck);
                    const deckEl = document.createElement('div');
                    deckEl.className = 'flex items-center gap-2 sm:gap-4';
                    deckEl.innerHTML = `
                        <button data-index="${originalIndex}" class="start-game-btn flex-grow bg-cyan-400 hover:bg-cyan-500 text-white font-bold py-3 px-4 sm:py-4 sm:px-6 rounded-lg text-base sm:text-2xl btn-3d">${deck.name} (${deck.questions.length}„ÇÇ„Çì)</button>
                        <button data-index="${originalIndex}" class="edit-deck-btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold p-3 sm:p-4 rounded-lg btn-3d text-lg sm:text-2xl">‚úèÔ∏è</button>
                        ${!deck.isDefault ? `<button data-index="${originalIndex}" class="delete-deck-btn bg-red-500 hover:bg-red-600 text-white font-bold p-3 sm:p-4 rounded-lg btn-3d text-lg sm:text-2xl">üóëÔ∏è</button>` : ''}
                    `;
                    deckList.appendChild(deckEl);
                });
            }
        }

        // --- Deck Editor ---
        let tempQuestions = [];
        function openDeckEditor(index = -1) {
            if (index === -1) { // New Deck
                deckNameInput.value = '';
                tempQuestions = [];
                currentDeckIndex = -1;
            } else { // Edit Deck
                const deck = allDecks[index];
                if (deck.isDefault) {
                    deckNameInput.value = deck.name + '„ÅÆ„Ç≥„Éî„Éº';
                    currentDeckIndex = -1; // Treat as new deck
                } else {
                    deckNameInput.value = deck.name;
                    currentDeckIndex = index;
                }
                tempQuestions = JSON.parse(JSON.stringify(deck.questions));
            }
            renderQuestionsList();
            showScreen('deckEditor');
        }

        function renderQuestionsList() {
            questionsList.innerHTML = '';
            if(tempQuestions.length === 0) {
                questionsList.innerHTML = `<p class="text-gray-400 text-center p-4 text-base sm:text-lg">„Åæ„Å†ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>`;
            }
            tempQuestions.forEach((q, index) => {
                const qEl = document.createElement('div');
                qEl.className = 'bg-white p-2 sm:p-3 border rounded flex justify-between items-center text-sm sm:text-lg';
                qEl.innerHTML = `
                    <span class="truncate pr-2"><b>Q:</b> ${q.q} / <b>A:</b> ${q.a}</span>
                    <button data-index="${index}" class="delete-question-btn bg-red-500 text-white rounded px-2 py-1 text-xs sm:text-base">„Åï„Åè„Åò„Çá</button>
                `;
                questionsList.appendChild(qEl);
            });
        }

        // --- Game Setup ---
        function showSetupScreen(deckIndex) {
            currentDeckIndex = deckIndex;
            const deck = allDecks[deckIndex];
            setupTitle.textContent = `„Äé${deck.name}„Äè`;
            questionCountButtons.innerHTML = '';
            const counts = [5, 10, 15, 20];
            counts.forEach(count => {
                 if(deck.questions.length >= count) {
                     questionCountButtons.innerHTML += `<button data-questions="${count}" class="question-btn bg-cyan-400 hover:bg-cyan-500 text-white font-bold py-4 sm:py-5 px-4 rounded-lg text-lg sm:text-2xl btn-3d">${count}„Å≤„Åç</button>`;
                 }
            });
            if (deck.questions.length > 0) {
                 questionCountButtons.innerHTML += `<button data-questions="${deck.questions.length}" class="question-btn bg-cyan-400 hover:bg-cyan-500 text-white font-bold py-4 sm:py-5 px-4 rounded-lg text-lg sm:text-2xl btn-3d">„Åú„Çì„Å∂(${deck.questions.length}„Å≤„Åç)</button>`;
            } else {
                 questionCountButtons.innerHTML = `<p class="text-gray-500 col-span-2 lg:col-span-4 text-lg sm:text-xl">ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ<br>„Éá„ÉÉ„Ç≠„ÇíÁ∑®ÈõÜ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>`
            }
            showScreen('setup');
        }

        // --- Core Game Logic ---
        function startGame(numQuestions) {
            totalMonsters = numQuestions;
            defeatedMonsters = 0;
            mistakes = 0;
            buttonsDisabled = false;

            let deckQuestions = [...allDecks[currentDeckIndex].questions];
            currentQuestions = deckQuestions.sort(() => 0.5 - Math.random()).slice(0, totalMonsters);
            currentQuestions.forEach(q => q.result = null);
            currentQuestionIndex = 0;

            updateLives();
            showScreen('main');
            initializeCanvas();
            spawnMonster();
            displayQuestion();
            updateCounter();
        }

        function nextTurn() {
            buttonsDisabled = false;
            updateCounter();
            spawnMonster();
            displayQuestion();
        }

        function displayQuestion() {
            clearCanvas();
            if (currentQuestionIndex >= currentQuestions.length || currentQuestionIndex >= totalMonsters) {
                 showClearScreen();
                return;
            }
            const qa = currentQuestions[currentQuestionIndex];
            questionDisplay.innerHTML = `<b>„ÇÇ„Çì„Å†„ÅÑÔºö</b> ${qa.q}`;
            buttonsDisabled = false;
            startTimer();
        }

        function spawnMonster() {
            monsterArea.innerHTML = '';
            let monster;
            // UPDATED: Monster size is now responsive and different for the boss
            let monsterSize;

            if (defeatedMonsters === totalMonsters - 1) {
                monster = BOSS_MONSTER;
                monsterTitle.textContent = `„Å§„ÅÑ„Å´${monster.name}„Åå„ÅÇ„Çâ„Çè„Çå„ÅüÔºÅ`;
                // Boss monster size
                monsterSize = 'w-36 h-36 sm:w-48 sm:h-48';
            } else {
                monster = MONSTERS[Math.floor(Math.random() * MONSTERS.length)];
                monsterTitle.textContent = `${monster.name}„Åå„ÅÇ„Çâ„Çè„Çå„ÅüÔºÅ`;
                // Regular monster size
                monsterSize = 'w-32 h-32 sm:w-44 sm:h-44';
            }

            const monsterEl = document.createElement('div');
            monsterEl.className = `${monsterSize} animate-spawn flex items-center justify-center`;

            const img = document.createElement('img');
            img.src = monster.image;
            img.className = 'w-full h-full object-contain';
            img.alt = monster.name;

            monsterEl.appendChild(img);
            monsterArea.appendChild(monsterEl);
        }

        function updateCounter() {
            counter.textContent = `„ÅÆ„Åì„Çä ${totalMonsters - defeatedMonsters} „Å≤„Åç`;
        }

        function updateLives() {
            livesArea.innerHTML = '‚ù§Ô∏è'.repeat(MAX_MISTAKES - mistakes) + 'üñ§'.repeat(mistakes);
        }

        function handleCorrect() {
            stopTimer();
            if (buttonsDisabled || currentQuestionIndex >= currentQuestions.length) return;
            buttonsDisabled = true;
            playSound('correct');
            currentQuestions[currentQuestionIndex].result = 'correct';
            const monsterEl = monsterArea.querySelector('div');
            monsterEl?.classList.add('animate-defeat');
            monsterEl?.addEventListener('animationend', () => {
                defeatedMonsters++;
                currentQuestionIndex++;
                if (defeatedMonsters >= totalMonsters) {
                    showClearScreen();
                } else {
                    nextTurn();
                }
            }, { once: true });
        }

        function handleRetry() {
            if (buttonsDisabled) return;
            playSound('incorrect');
            const monsterEl = monsterArea.querySelector('div');
            monsterEl?.classList.add('animate-shake');
            monsterEl?.addEventListener('animationend', () => {
                monsterEl.classList.remove('animate-shake');
            }, { once: true });
            clearCanvas();
        }

        function handleTimeUp() {
            stopTimer();
            if (buttonsDisabled || currentQuestionIndex >= currentQuestions.length) return;
            buttonsDisabled = true;
            playSound('incorrect');

            currentQuestions[currentQuestionIndex].result = 'incorrect';
            mistakes++;
            updateLives();

            if (mistakes >= MAX_MISTAKES) {
                setTimeout(showGameOverScreen, 500);
                return;
            }

            const monsterEl = monsterArea.querySelector('div');
            monsterEl?.classList.add('animate-shake');
            monsterEl?.addEventListener('animationend', () => {
                monsterEl.classList.remove('animate-shake');
                currentQuestionIndex++;
                 if (currentQuestionIndex >= totalMonsters) {
                     showClearScreen();
                 } else {
                    displayQuestion();
                 }
            }, { once: true });
        }

        // --- Timer ---
        function startTimer() {
            stopTimer();
            let timeLeft = TIME_LIMIT;
            timerBar.style.transition = 'width 1s linear';
            const updateTimerDisplay = () => {
                const percentage = (timeLeft / TIME_LIMIT) * 100;
                timerBar.style.width = `${percentage}%`;
            };
            updateTimerDisplay();
            questionTimer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft < 0) {
                    handleTimeUp();
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(questionTimer);
            questionTimer = null;
            timerBar.style.transition = 'none';
        }

        // --- Canvas Drawing ---
        function initializeCanvas() {
            if(!canvasCtx) canvasCtx = handwritingCanvas.getContext('2d');
            const { width, height } = handwritingCanvas.getBoundingClientRect();
            handwritingCanvas.width = width;
            handwritingCanvas.height = height;
            canvasCtx.strokeStyle = '#374151';
            canvasCtx.lineWidth = Math.max(2, width / 100); // Responsive line width
            canvasCtx.lineJoin = 'round';
            canvasCtx.lineCap = 'round';
            clearCanvas();
        }

        function clearCanvas() {
            if(canvasCtx) canvasCtx.clearRect(0, 0, handwritingCanvas.width, handwritingCanvas.height);
        }

        function getCoords(e) {
            const rect = handwritingCanvas.getBoundingClientRect();
            const touch = e.touches && e.touches[0];
            return [
                (touch ? touch.clientX : e.clientX) - rect.left,
                (touch ? touch.clientY : e.clientY) - rect.top
            ];
        }

        function startDrawing(e) { e.preventDefault(); isDrawing = true; [lastX, lastY] = getCoords(e); }
        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const [currentX, currentY] = getCoords(e);
            canvasCtx.beginPath();
            canvasCtx.moveTo(lastX, lastY);
            canvasCtx.lineTo(currentX, currentY);
            canvasCtx.stroke();
            [lastX, lastY] = [currentX, currentY];
        }
        function stopDrawing() { isDrawing = false; }

        // --- Result Screens ---
        function renderResults(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `<h3 class="text-xl sm:text-2xl font-bold mb-4 text-center">„ÇÇ„Çì„Å†„ÅÑ„Å®„Åì„Åü„Åà</h3>`;
            const list = document.createElement('ul');
            list.className = 'space-y-3';
            const answeredQuestions = currentQuestions.filter(q => q.result);
            answeredQuestions.forEach(qa => {
                const item = document.createElement('li');
                item.className = 'border-b border-gray-400 pb-2 text-sm sm:text-lg';
                let resultHTML = qa.result === 'correct'
                    ? `<span class="font-bold text-green-500 mr-2">[„Åõ„ÅÑ„Åã„ÅÑÔºÅ]</span>`
                    : `<span class="font-bold text-red-500 mr-2">[„Åµ„Åõ„ÅÑ„Åã„ÅÑ‚Ä¶]</span>`;
                item.innerHTML = `<div>${resultHTML}<b>Q:</b> ${qa.q}</div><div class="pl-6"><b class="${containerId.includes('clear') ? 'text-blue-600' : 'text-cyan-400'}">A:</b> ${qa.a}</div>`;
                list.appendChild(item);
            });
            if (answeredQuestions.length === 0) { list.innerHTML = `<p class="text-gray-500">„Åë„Å£„Åã„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>`; }
            container.appendChild(list);
        }

        function showClearScreen() {
            stopTimer();
            showScreen('clear');
            renderResults('clear-results-area');
            startConfetti();
        }

        function showGameOverScreen() {
            stopTimer();
            showScreen('gameover');
            renderResults('gameover-results-area');
        }

        // --- Event Listeners ---
        deckCategoryTabs.addEventListener('click', e => {
            const target = e.target.closest('button');
            if (target && target.dataset.category) {
                selectedCategory = target.dataset.category;
                renderDeckSelectionScreen();
            }
        });

        deckList.addEventListener('click', e => {
            const target = e.target.closest('button');
            if (!target) return;
            const index = parseInt(target.dataset.index);
            if (target.classList.contains('start-game-btn')) {
                if(allDecks[index].questions.length > 0) showSetupScreen(index);
                else alert('„Åì„ÅÆ„Éá„ÉÉ„Ç≠„Å´„ÅØÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇÁ∑®ÈõÜ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            } else if (target.classList.contains('edit-deck-btn')) {
                openDeckEditor(index);
            } else if (target.classList.contains('delete-deck-btn')) {
                if (confirm(`„Äå${allDecks[index].name}„Äç„ÇíÊú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)) {
                    allDecks.splice(index, 1);
                    saveUserDecks();
                    renderDeckSelectionScreen();
                }
            }
        });

        newDeckBtn.addEventListener('click', () => openDeckEditor(-1));

        addQuestionBtn.addEventListener('click', () => {
            const q = newQuestionInput.value.trim();
            const a = newAnswerInput.value.trim();
            if (q && a) {
                tempQuestions.push({ q, a });
                newQuestionInput.value = '';
                newAnswerInput.value = '';
                renderQuestionsList();
                newQuestionInput.focus();
            }
        });

        questionsList.addEventListener('click', e => {
            if (e.target.classList.contains('delete-question-btn')) {
                const index = parseInt(e.target.dataset.index);
                tempQuestions.splice(index, 1);
                renderQuestionsList();
            }
        });

        saveDeckBtn.addEventListener('click', () => {
            const name = deckNameInput.value.trim();
            if (!name) { alert('„Éá„ÉÉ„Ç≠„ÅÆ„Å™„Åæ„Åà„Çí„ÅÑ„Çå„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ'); return; }
            const newDeck = { name, questions: tempQuestions, isDefault: false, category: '„Åò„Å∂„Çì„ÅÆ„Éá„ÉÉ„Ç≠' };
            if (currentDeckIndex === -1 || allDecks[currentDeckIndex]?.isDefault) {
                allDecks.push(newDeck);
            } else {
                allDecks[currentDeckIndex] = newDeck;
            }
            saveUserDecks();
            loadAndCombineDecks();
            selectedCategory = '„Åò„Å∂„Çì„ÅÆ„Éá„ÉÉ„Ç≠';
            renderDeckSelectionScreen();
            showScreen('deckSelection');
        });

        backToSelectionBtn.addEventListener('click', () => showScreen('deckSelection'));

        questionCountButtons.addEventListener('click', e => {
            if (e.target.classList.contains('question-btn')) {
                startGame(parseInt(e.target.dataset.questions));
            }
        });

        backToDecksBtn.addEventListener('click', () => {
            renderDeckSelectionScreen();
            showScreen('deckSelection');
        });

        correctBtn.addEventListener('click', handleCorrect);
        retryBtn.addEventListener('click', handleRetry);

        document.querySelectorAll('.restart-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                renderDeckSelectionScreen();
                showScreen('deckSelection');
                stopConfetti();
            });
        });

        // Canvas Event Listeners
        handwritingCanvas.addEventListener('mousedown', startDrawing);
        handwritingCanvas.addEventListener('mousemove', draw);
        handwritingCanvas.addEventListener('mouseup', stopDrawing);
        handwritingCanvas.addEventListener('mouseout', stopDrawing);
        handwritingCanvas.addEventListener('touchstart', startDrawing, { passive: false });
        handwritingCanvas.addEventListener('touchmove', draw, { passive: false });
        handwritingCanvas.addEventListener('touchend', stopDrawing);
        clearCanvasBtn.addEventListener('click', clearCanvas);
        window.addEventListener('resize', initializeCanvas);

        // --- App Initialization ---
        function initApp() {
            loadAndCombineDecks();
            renderDeckSelectionScreen();
            showScreen('deckSelection');
        }
        initApp();

        // --- Confetti Effect ---
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        let confettiParticles = []; let animationFrameId;
        function startConfetti(){if(!canvas)return;canvas.width=window.innerWidth;canvas.height=window.innerHeight;confettiParticles=[];for(let i=0;i<100;i++){confettiParticles.push(createParticle())}renderConfetti()}
        function stopConfetti(){if(animationFrameId)cancelAnimationFrame(animationFrameId)}
        function createParticle(){const colors=['#f9a8d4','#f472b6','#86efac','#34d399','#67e8f9','#22d3ee','#fcd34d','#fbbf24'];return{x:Math.random()*canvas.width,y:Math.random()*canvas.height-canvas.height,size:Math.random()*8+5,color:colors[Math.floor(Math.random()*colors.length)],speed:Math.random()*3+2,angle:Math.random()*360,spin:Math.random()<.5?-1:1}}
        function renderConfetti(){if(!canvas)return;ctx.clearRect(0,0,canvas.width,canvas.height);confettiParticles.forEach((p,i)=>{p.y+=p.speed;p.angle+=p.spin*5;ctx.save();ctx.fillStyle=p.color;ctx.translate(p.x+p.size/2,p.y+p.size/2);ctx.rotate(p.angle*Math.PI/180);ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size);ctx.restore();if(p.y>canvas.height){confettiParticles[i]=createParticle();confettiParticles[i].y=-10}});animationFrameId=requestAnimationFrame(renderConfetti)}
    });
    </script>
</body>
</html>
